apiVersion: apps/v1
# API group/version for Kubernetes workload controllers like Deployment, StatefulSet, DaemonSet.

kind: Deployment
# Deployment manages a ReplicaSet and ensures a desired number of pod replicas are running.
# Practical: supports rolling updates, self-healing, and easy scaling.

metadata:
  name: hello
  # Deployment name. Used for identification and for commands like:
  # kubectl -n hello rollout status deploy/hello

  namespace: hello
  # Deploy into the "hello" namespace to isolate this app from other workloads.

spec:
  replicas: 3
  # Desired number of pod replicas.
  # Practical: demo of high availability + load balancing; also works with HPA (if HPA is present,
  # it can override this value by scaling replicas up/down).

  selector:
    matchLabels:
      app: hello
      # Deployment selects pods with label app=hello.
      # IMPORTANT: must match the labels in template.metadata.labels, otherwise it won't manage its own pods.

  template:
    # Pod template: defines how the pods created by this Deployment look.

    metadata:
      labels:
        app: hello
        # Labels applied to created pods.
        # Practical: used by Deployment selector, Service selectors, and operational filtering.

    spec:
      containers:
        - name: nginx
          # Container name inside the pod. Useful for logs/exec:
          # kubectl -n hello logs deploy/hello -c nginx

          image: nginx:1.27
          # Container image and tag.
          # Practical: pinning a version avoids unexpected changes from "latest".

          ports:
            - containerPort: 80
              # Declares the port the container listens on.
              # Practical: helps readability; Services/Probes still need correct port numbers.

          resources:
            requests:
              cpu: "50m"
              memory: "64Mi"
              # Requests = guaranteed resources for scheduling.
              # Practical: Kubernetes scheduler uses requests to place pods on nodes.

            limits:
              cpu: "300m"
              memory: "128Mi"
              # Limits = maximum resources the container may use.
              # Practical: CPU limits throttle; memory limits may cause OOMKill if exceeded.

          readinessProbe:
            # Readiness probe controls whether the pod is ready to receive traffic.
            # Practical: Service/Ingress will send traffic only to ready pods.
            httpGet:
              path: /healthz
              # Must match the endpoint exposed by NGINX config (ConfigMap).
              port: 80
              # Probe target port inside the container.
            initialDelaySeconds: 3
            # Wait 3 seconds after container start before probing.
            periodSeconds: 5
            # Probe every 5 seconds.

          livenessProbe:
            # Liveness probe checks if the container is still healthy.
            # Practical: if it fails repeatedly, Kubernetes restarts the container.
            httpGet:
              path: /healthz
              port: 80
            initialDelaySeconds: 10
            # Give the container more time to start before liveness checks (avoid restart loops).
            periodSeconds: 10
            # Probe every 10 seconds.

          volumeMounts:
            - name: nginxconf
              # Refers to a volume defined below in spec.volumes.
              mountPath: /etc/nginx/conf.d/default.conf
              # Mount location inside the container.
              # Practical: NGINX reads config files from /etc/nginx/conf.d/*.conf.
              subPath: default.conf
              # Mount only a single file from the volume (not the whole directory).
              # Practical: avoids replacing the entire /etc/nginx/conf.d directory.

      volumes:
        - name: nginxconf
          # Defines a pod volume named "nginxconf" sourced from a ConfigMap.
          configMap:
            name: hello-nginx
            # Name of the ConfigMap that contains NGINX configuration (default.conf).

            items:
              - key: default.conf
                # Which key from the ConfigMap to project into the volume.
                path: default.conf
                # Filename inside the volume. Must match subPath above.
